{% extends 'generic/call_review_tabulation.html' %}

{% block heading_line_one %}
    <th rowspan="2" class="sideways"><div><div>Request (hours)</div></div></th>
    <th colspan="{{ jcmt_weathers | length + 1 }}" class="spacer_left">Weather</th>
    <th colspan="{{ jcmt_instruments | length + 1 }}" class="spacer_left">Instrument</th>
{% endblock %}

{% block heading_line_two %}
    {% for weather in jcmt_weathers.values() %}
        <th class="sideways{{ ' spacer_left' if loop.first }}"><div><div>{{ weather.name }}</div></div></th>
    {% endfor %}
    <th class="sideways"><div><div>Unknown</div></div></th>
    {% for instrument in jcmt_instruments.values() %}
        <th class="sideways{{ ' spacer_left' if loop.first }}"><div><div>{{ instrument }}</div></div></th>
    {% endfor %}
    <th class="sideways"><div><div>Unknown</div></div></th>
{% endblock %}

{% macro render_cell_class(is_total, is_first) %}{% if is_total or is_first %}class="{{ 'total' if is_total }}{{ ' ' if is_total and is_first }}{{ 'spacer_left' if is_first }}"{% endif %}{% endmacro %}

{% macro render_jcmt_request(request, is_total=false) %}
    <td {{ render_cell_class(is_total, false) }}>{{ request.total | fmt('{:.1f}') }}</td>
    {% for weather in jcmt_weathers %}
        <td {{ render_cell_class(is_total, loop.first) }}>{{ request.weather[weather] | fmt('{:.1f}')}}</td>
    {% endfor %}
    <td {{ render_cell_class(is_total, false) }}>{{ request.weather[0] | fmt('{:.1f}')}}</td>
    {% for instrument in jcmt_instruments %}
        <td {{ render_cell_class(is_total, loop.first) }}>{{ request.instrument[instrument] | fmt('{:.1f}')}}</td>
    {% endfor %}
    <td {{ render_cell_class(is_total, false) }}>{{ request.instrument[0] | fmt('{:.1f}')}}</td>
{% endmacro %}

{% block row_extra %}
    {{ render_jcmt_request(proposal.jcmt_request) }}
{% endblock %}

{% block table_footer %}
    <tr>
        <th colspan="4">Total (hours)</th>
        <td colspan="3" class="total spacer_left">&nbsp;</td>
        {{ render_jcmt_request(jcmt_request_total, is_total=true) }}
        <td colspan="{{ affiliations | length + 1 }}" class="total spacer_left">&nbsp;</td>
    </tr>
{% endblock %}
